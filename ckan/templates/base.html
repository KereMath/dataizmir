{# Allows the DOCTYPE to be set on a page by page basis #}
{%- block doctype %}<!DOCTYPE html>{% endblock -%}

{# Allows custom attributes to be added to the <html> tag #}
{%- block htmltag -%}
{% set lang = h.lang() %}
<!--[if IE 9]> <html lang="{{ lang }}" class="ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="{{ lang }}"> <!--<![endif]-->
{%- endblock -%}

{# Allows custom attributes to be added to the <head> tag #}
<head{% block headtag %}{% endblock %}>

  {# Meta Tags #}
  {%- block meta -%}
    <meta charset="utf-8" />
    {% block meta_generator %}<meta name="generator" content="ckan {{ h.ckan_version() }}" />{% endblock %}
    {% block meta_viewport %}<meta name="viewport" content="width=device-width, initial-scale=1.0">{% endblock %}
  {%- endblock -%}

  {# Page Title #}
  <title>
    {%- block title -%}
      {%- block subtitle %}{% endblock -%}
      {%- if self.subtitle()|trim %} {{ g.template_title_delimiter }} {% endif -%}
      {{ g.site_title }}
    {%- endblock -%}
  </title>

  {# Favicon and Links #}
  {% block links -%}
    <link rel="shortcut icon" href="{{ g.favicon }}" />
  {% endblock -%}

  {# External CSS Libraries #}
  <!-- Font Awesome 4.7.0 - CKAN Compatible -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  
  <!-- Bootstrap 3.4.1 - CKAN Compatible -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  {# CKAN Styles #}
  {%- block styles %}
    <!-- CKAN Base CSS -->
    <link rel="stylesheet" href="{{ h.url_for_static('/base/css/main.css') }}" type="text/css">
    
    <!-- Custom Font and Base Styles -->
    <style>
      body, html, * {
        font-family: 'Montserrat', sans-serif !important;
      }
      
      /* Font Awesome Fix */
      .fa {
        font-family: 'FontAwesome' !important;
        display: inline-block;
        font-style: normal;
        font-weight: normal;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Bootstrap and CKAN compatibility fixes */
      .container-fluid {
        max-width: none;
      }
      
      .navbar-brand {
        font-weight: 600;
      }
      
      /* Modern button styles */
      .btn {
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
      }
      
      .btn:hover {
        transform: translateY(-1px);
      }
      
      /* Form improvements */
      .form-control {
        border-radius: 4px;
        border: 1px solid #ddd;
        transition: border-color 0.2s ease;
      }
      
      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }
      
      /* Responsive improvements */
      @media (max-width: 768px) {
        .container {
          padding-left: 10px;
          padding-right: 10px;
        }
      }
    </style>
  {% endblock %}

  {# Head Extras #}
  {% block head_extras %}
    {# defined in the config.ini under "ckan.template_head_end" #}
    {{ g.template_head_end | safe }}
  {% endblock %}

  {# Custom Site Styles #}
  {%- block custom_styles %}
    {%- if g.site_custom_css -%}
    <style>
      {{ g.site_custom_css | safe }}
    </style>
    {%- endif %}
  {% endblock %}
</head>

{# Body Tag #}
<body{% block bodytag %} data-site-root="{{ h.url_for('/', locale='default', qualified=true) }}" data-locale-root="{{ h.url_for('/', qualified=true) }}" {% endblock %}>

  {# Main Page Content #}
  {%- block page %}{% endblock -%}

  {# JavaScript Libraries #}
  {%- block scripts %}
    <!-- jQuery (required for Bootstrap 3) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    
    <!-- Bootstrap 3.4.1 JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
    
    <!-- CKAN Base JavaScript -->
    <script src="{{ h.url_for_static('/base/javascript/modules/jquery.module.js') }}"></script>
    <script src="{{ h.url_for_static('/base/javascript/ckan.js') }}"></script>
    
    <!-- Font Awesome Icon Test Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Test if Font Awesome is loaded
        var testIcon = document.createElement('i');
        testIcon.className = 'fa fa-home';
        testIcon.style.display = 'none';
        document.body.appendChild(testIcon);
        
        var computed = window.getComputedStyle(testIcon, ':before');
        var content = computed.getPropertyValue('content');
        
        if (content && content !== 'none' && content !== '') {
          console.log('✅ Font Awesome loaded successfully');
        } else {
          console.warn('⚠️ Font Awesome not loaded properly');
        }
        
        document.body.removeChild(testIcon);
      });
    </script>
  {% endblock -%}

  {# Body Extras #}
  {% block body_extras -%}
    {# defined in the config.ini under "ckan.template_footer_end" #}
    {{ g.template_footer_end | safe }}
  {% endblock %}

</body>
</html>