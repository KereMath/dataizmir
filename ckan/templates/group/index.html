{% extends "page.html" %}

{% block subtitle %}{{ _('Groups') }}{% endblock %}
{%- block header %}
    {% include "header.html" %}
    <div id="title" class="package-title container-fluid" style="background-image:url(&quot;/base/images/theme/background_photo.jpg&quot;);color: #fff;">
      <div class="background-overlay">
      <div class="restricted-max-width">
      <div class="col-xs-12 col-md-10 col-md-offset-1">
      <div id="title-container" class="col-xs-10 col-md-6 text-left">
      <h1 style="margin-left: 200px;">{{ _('Groups') }}</h1>
      </div>
      <div id="stats" class="col-xs-12 col-md-4 col-md-offset-2">
      <div class="col-xs-12" style="text-align: center;margin-top: 20px;font-size: 16px;">
      <p class="stat" style="font-size: 30px;font-weight: bolder;">{{page.item_count}}<span style="font-size: 18px"> {{ _('Group') }}</span></p>
      </div>
      </div>
      </div>
      </div>
      </div>
      </div>
  {% endblock -%}
{% block breadcrumb_content %}
  <li class="active">{% link_for _('Groups'), named_route=group_type+'.index' %}</li>
{% endblock %}

{% block page_header %}{% endblock %}

{% block page_primary_action %}
  {% if h.check_access('group_create') %}
    {% link_for _('Add Group'), named_route=group_type+'.new', class_='btn btn-primary', icon='plus-square' %}
  {% endif %}
{% endblock %}

{% block primary_content_inner %}
  <h1 class="hide-heading">{{ _('Groups') }}</h1>
  
  <!-- Grup Açıklaması Yukarıya Alındı -->
  <div class="groups-info" style="margin-bottom: 30px;">
    {% snippet "group/snippets/helper.html" %}
  </div>
  
  <!-- Arama ve Filtreleme -->
  <div class="search-and-filters" style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center; flex-wrap: wrap;">
    <!-- Arama Input -->
    <div style="flex: 2; min-width: 250px;">
      <input type="text" 
             class="form-control" 
             placeholder="Grup ismi ile arayın..." 
             value="{{ q or '' }}"
             id="search-groups"
             style="width: 100%;">
    </div>
    
    <!-- Sıralama -->
    <div style="flex: 1; min-width: 180px;">
      <select class="form-control" id="sort-select">
        <option value="title asc" {% if sort_by_selected == 'title asc' %}selected{% endif %}>İsim (A-Z)</option>
        <option value="title desc" {% if sort_by_selected == 'title desc' %}selected{% endif %}>İsim (Z-A)</option>
        <option value="package_count desc" {% if sort_by_selected == 'package_count desc' %}selected{% endif %}>En Çok Veri Seti</option>
        <option value="package_count asc" {% if sort_by_selected == 'package_count asc' %}selected{% endif %}>En Az Veri Seti</option>
      </select>
    </div>
    
    <!-- Sayfa başına gösterim -->
    <div style="flex: 1; min-width: 120px;">
      <select class="form-control" id="items-per-page">
        <option value="10" {% if request.params.get('limit', 20)|int == 10 %}selected{% endif %}>10'lu</option>
        <option value="20" {% if request.params.get('limit', 20)|int == 20 %}selected{% endif %}>20'li</option>
        <option value="50" {% if request.params.get('limit', 20)|int == 50 %}selected{% endif %}>50'li</option>
        <option value="100" {% if request.params.get('limit', 20)|int == 100 %}selected{% endif %}>100'lü</option>
      </select>
    </div>
  </div>
  
  {% block groups_list %}
    {% if page.items or request.params %}
      {% if page.items %}
        {% snippet "group/snippets/group_list.html", groups=page.items %}
      {% endif %}
    {% else %}
      <p class="empty">
        {{ _('There are currently no groups for this site') }}.
        {% if h.check_access('group_create') %}
          {% link_for _('How about creating one?'), named_route=group_type+'.new' %}</a>.
        {% endif %}
      </p>
    {% endif %}
  {% endblock %}
  
  {% block page_pagination %}
    {{ page.pager(q=q or '', sort=sort_by_selected or '', limit=request.params.get('limit', 20)) }}
  {% endblock %}
{% endblock %}

{% block secondary_content %}
  <!-- Boş bırakıldı çünkü helper yukarıya taşındı -->
{% endblock %}

<script>
function updateFilters() {
    const searchInput = document.getElementById('search-groups');
    const sortSelect = document.getElementById('sort-select');
    const itemsSelect = document.getElementById('items-per-page');
    
    const url = new URL(window.location);
    
    // Arama terimi
    if (searchInput && searchInput.value.trim()) {
        url.searchParams.set('q', searchInput.value.trim());
    } else {
        url.searchParams.delete('q');
    }
    
    // Sıralama
    if (sortSelect && sortSelect.value) {
        url.searchParams.set('sort', sortSelect.value);
    }
    
    // Sayfa başına gösterim
    if (itemsSelect && itemsSelect.value) {
        url.searchParams.set('limit', itemsSelect.value);
    }
    
    // Sayfa numarasını sıfırla
    url.searchParams.delete('page');
    
    window.location.href = url.toString();
}

document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-groups');
    const sortSelect = document.getElementById('sort-select');
    const itemsSelect = document.getElementById('items-per-page');
    
    // Arama - 500ms gecikme ile
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(updateFilters, 500);
        });
    }
    
    // Sıralama - anında
    if (sortSelect) {
        sortSelect.addEventListener('change', updateFilters);
    }
    
    // Sayfa başına gösterim - anında
    if (itemsSelect) {
        itemsSelect.addEventListener('change', updateFilters);
    }
});
</script>

<style>
.groups-info .module {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
}

.search-and-filters {
    background: #fff;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

@media (max-width: 768px) {
    .search-and-filters {
        flex-direction: column;
    }
    
    .search-and-filters > div {
        width: 100% !important;
        flex: none !important;
    }
}
</style>