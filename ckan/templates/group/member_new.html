{% extends "group/edit_base.html" %}

{% import 'macros/form.html' as form %}

{% set user = user_dict %}

{% block primary_content_inner %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;700&display=swap');

  /* === FUTURISTIC THEME START === */

  body, .primary-content, .content-wrapper, .secondary {
    background-color: #0a0f1e !important;
    color: #e0e0e0 !important;
    font-family: 'Roboto', sans-serif !important;
  }

  h1.page-heading, h3.page-heading {
    font-family: 'Orbitron', sans-serif !important;
    color: #00f2ff !important;
    text-transform: uppercase !important;
    letter-spacing: 2px !important;
    text-shadow: 0 0 5px rgba(0, 242, 255, 0.7), 0 0 10px rgba(0, 242, 255, 0.5) !important;
    border-bottom: 1px solid rgba(0, 242, 255, 0.3) !important;
    padding-bottom: 15px !important;
    margin-bottom: 30px !important;
  }
  
  /* --- Links --- */
  a {
    color: #00f2ff !important;
    text-decoration: none !important;
    transition: all 0.3s ease !important;
  }
  
  a:hover {
    color: #ffffff !important;
    text-shadow: 0 0 8px rgba(0, 242, 255, 0.8) !important;
  }
  
  p {
    color: #a0a0a0 !important;
    line-height: 1.6 !important;
  }

  /* --- Buttons --- */
  .btn {
    font-family: 'Orbitron', sans-serif !important;
    text-transform: uppercase !important;
    border-radius: 0 !important;
    background: transparent !important;
    transition: all 0.3s ease !important;
    padding: 10px 20px !important;
    font-size: 14px !important;
    letter-spacing: 1px !important;
    box-shadow: 0 0 5px rgba(0,0,0,0.5) inset !important;
  }

  .btn-primary {
    border: 1px solid #00f2ff !important;
    color: #00f2ff !important;
  }

  .btn-primary:hover {
    background-color: #00f2ff !important;
    color: #0a0f1e !important;
    box-shadow: 0 0 15px rgba(0, 242, 255, 0.7) !important;
  }
  
  .btn-default {
    border: 1px solid #a0a0a0 !important;
    color: #a0a0a0 !important;
  }
  
  .btn-default:hover {
    background-color: #a0a0a0 !important;
    color: #0a0f1e !important;
    box-shadow: 0 0 15px rgba(160, 160, 160, 0.7) !important;
  }
  
  .btn-danger {
    border: 1px solid #ff00ff !important;
    color: #ff00ff !important;
  }

  .btn-danger:hover {
    background-color: #ff00ff !important;
    color: #0a0f1e !important;
    box-shadow: 0 0 15px rgba(255, 0, 255, 0.7) !important;
  }

  /* --- Form Styling --- */
  .dataset-form .control-label {
    font-family: 'Orbitron', sans-serif !important;
    color: #00f2ff !important;
    font-size: 16px !important;
    letter-spacing: 1px !important;
    margin-bottom: 10px !important;
  }
  
  .dataset-form input[type="text"], .dataset-form select {
    background-color: rgba(0, 30, 40, 0.7) !important;
    border: 1px solid rgba(0, 242, 255, 0.5) !important;
    color: #e0e0e0 !important;
    padding: 12px 15px !important;
    border-radius: 0 !important;
    font-size: 14px !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 0 10px rgba(0, 242, 255, 0.1) inset !important;
  }
  
  .dataset-form input[type="text"]:focus, .dataset-form select:focus {
    outline: none !important;
    border-color: #00f2ff !important;
    box-shadow: 0 0 10px rgba(0, 242, 255, 0.5) !important;
  }
  
  .dataset-form input::placeholder {
    color: rgba(224, 224, 224, 0.4) !important;
  }

  .dataset-form input:disabled, .dataset-form select:disabled {
    background-color: rgba(40, 40, 50, 0.5) !important;
    cursor: not-allowed !important;
    color: #777 !important;
  }
  
  .add-member-or-wrap {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: 160px !important; /* Adjust to align with form groups */
  }

  .add-member-or {
    font-family: 'Orbitron', sans-serif !important;
    color: #ff00ff !important;
    text-transform: uppercase !important;
    font-size: 20px !important;
    text-shadow: 0 0 5px #ff00ff !important;
    position: relative !important;
  }
  
  .add-member-or::before, .add-member-or::after {
    content: '' !important;
    position: absolute !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 60px !important;
    height: 1px !important;
    background-color: rgba(255, 0, 255, 0.5) !important;
  }
  
  .add-member-or::before {
    top: -15px !important;
  }
  
  .add-member-or::after {
    bottom: -15px !important;
  }
  
  .form-actions {
    margin-top: 40px !important;
    padding-top: 20px !important;
    border-top: 1px solid rgba(0, 242, 255, 0.3) !important;
    background: transparent !important;
  }

  /* --- Secondary Content (Info Box) --- */
  .module-narrow {
    background-color: rgba(10, 15, 30, 0.8) !important;
    border: 1px solid rgba(0, 242, 255, 0.3) !important;
    border-left: 3px solid #00f2ff !important;
    padding: 20px !important;
    border-radius: 0 !important;
    box-shadow: -5px 0 15px rgba(0, 242, 255, 0.1) !important;
  }
  
  .module-heading {
    font-family: 'Orbitron', sans-serif !important;
    color: #00f2ff !important;
    font-size: 1.3em !important;
    margin-bottom: 15px !important;
    letter-spacing: 1px !important;
    border-bottom: none !important;
  }
  
  .module-content p {
    color: #b0b0b0 !important;
    font-size: 14px !important;
  }
  
  .module-content strong {
    color: #ffffff !important;
  }

  /* === FUTURISTIC THEME END === */
</style>

  {% link_for _('Back to all members'), named_route=group_type+'.members', id=group.name, class_='btn btn-default pull-right', icon='arrow-left' %}
  <h1 class="page-heading">
    {% block page_heading %}{{ _('Edit Member') if user else _('Add Member') }}{% endblock %}
  </h1>
  {% block form %}
  <form class="dataset-form add-member-form" method='post' id="add-member-form">
    <div class="row">
      <div class="col-md-5">
        <div class="form-group control-medium">
          {% if not user %}
            <label class="control-label" for="username">
              {{ _('Existing User') }}
            </label>
            <p>
              {{ _('If you wish to add an existing user, search for their username below.') }}
            </p>
          {% endif %}
          <div class="controls">
            {% if user %}
              <input type="hidden" name="username" value="{{ user.name }}" />
              <input id="username" name="username" type="text" value="{{ user.name }}"
              disabled="True" class="form-control control-medium">
            {% else %}
              <input id="username" type="text" name="username" placeholder="Username"
              value="" class="control-medium form-control" data-module="autocomplete"
              data-module-source="/api/2/util/user/autocomplete?ignore_self=true&q=?">
            {% endif %}
          </div>
        </div>
      </div>
      {% if not user %}
      <div class="col-md-2 add-member-or-wrap">
        <div class="add-member-or">
          {{ _('or') }}
        </div>
      </div>
      <div class="col-md-5">
        <div class="form-group control-medium">
          <label class="control-label" for="email">
            {{ _('New User') }}
          </label>
          <p>
            {{ _('If you wish to invite a new user, enter their email address.') }}
          </p>
          <div class="controls">
            <input id="email" type="text" name="email" placeholder="Email address" class="form-control">
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    {% if user and user.name == c.user and user_role == 'admin' %}
      {% set format_attrs = {'data-module': 'autocomplete', 'disabled': 'disabled', 'class': 'form-control'} %}
      {{ form.select('role', label=_('Role'), options=roles, selected=user_role, error='', attrs=format_attrs) }}
      {{ form.hidden('role', value=user_role) }}
    {% else %}
      {% set format_attrs = {'data-module': 'autocomplete', 'class': 'form-control'} %}
      {{ form.select('role', label=_('Role'), options=roles, selected=user_role, error='', attrs=format_attrs) }}
    {% endif %}

    <div class="form-actions">
      {% if user %}
        <a href="{{ h.url_for(group_type + '.member_delete', id=group_dict.id, user=user.id) }}" class="btn btn-danger pull-left" data-module="confirm-action" data-module-content="{{ _('Are you sure you want to delete this member?') }}">{{ _('Delete') }}</a>
        <button class="btn btn-primary" type="submit" name="submit" >
          {{ _('Save') }}
        </button>
      {% else %}
        <button class="btn btn-primary" type="submit" name="submit" >
          {{ _('Add Member') }}
        </button>
      {% endif %}
    </div>
  </form>
  {% endblock %}
{% endblock %}

{% block secondary_content %}
  {{ super() }}
  <div class="module module-narrow module-shallow">
    <h2 class="module-heading">
      <i class="fa fa-lg fa-info-circle"></i>
      {{ _('What are roles?') }}
    </h2>
    <div class="module-content">
      {% trans %}
         <p><strong>Admin:</strong> Can edit group information, as well as
           manage organization members.</p>
         <p><strong>Member:</strong> Can add/remove datasets from groups</p>
      {% endtrans %}
    </div>
  </div>
{% endblock %}