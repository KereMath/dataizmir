{% extends "page.html" %}

{% block subtitle %}{{ _('Organizations') }}{% endblock %}
{%- block header %}
    {% include "header.html" %}
    <div id="title" class="package-title container-fluid" style="background-image:url(&quot;/base/images/theme/background_photo.jpg&quot;);color: #fff;">
      <div class="background-overlay">
      <div class="restricted-max-width">
      <div class="col-xs-12 col-md-10 col-md-offset-1">
      <div id="title-container" class="col-xs-10 col-md-6 text-left">
      <h1 style="margin-left: 200px;">Veri Paydaşları</h1>
      </div>
      <div id="stats" class="col-xs-12 col-md-4 col-md-offset-2">
      <div class="col-xs-12" style="text-align: center;margin-top: 20px;font-size: 16px;">
      <p class="stat" style="font-size: 30px;font-weight: bolder;">{{page.item_count}}<span style="font-size: 18px"> Veri Paydaşı</span></p>
      </div>
      </div>
      </div>
      </div>
      </div>
      </div>
  {% endblock -%}
{% block breadcrumb_content %}
  <li class="active">{% link_for _('Organizations'), named_route=group_type+'.index' %}</li>
{% endblock %}

{% block page_header %}{% endblock %}

{% block page_primary_action %}
  {% if h.check_access('organization_create') %}
    {% link_for _('Add Organization'), named_route=group_type+'.new', class_='btn btn-primary', icon='plus-square' %}
  {% endif %}
{% endblock %}

{% block primary_content_inner %}
  <h1 class="hide-heading">{% block page_heading %}{{ _('Organizations') }}{% endblock %}</h1>
  
  <!-- Veri Paydaşları Açıklaması -->
  <div class="organizations-info" style="margin-bottom: 30px;">
    {% snippet "organization/snippets/helper.html" %}
  </div>
  
  <!-- Arama ve Filtreleme Formu -->
  <form method="GET" id="organization-filter-form" class="search-and-filters" style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center; flex-wrap: wrap;">
    <!-- Arama Input -->
    <div style="flex: 2; min-width: 250px;">
      <input type="text" 
             name="q"
             class="form-control" 
             placeholder="Veri paydaşı ismi ile arayın..." 
             value="{{ request.params.get('q', '') }}"
             id="search-organizations"
             style="width: 100%;">
    </div>
    
    <!-- Sıralama -->
    <div style="flex: 1; min-width: 180px;">
      <select name="sort" class="form-control" id="sort-select">
        <option value="title asc" {% if request.params.get('sort', 'title asc') == 'title asc' %}selected{% endif %}>İsim (A-Z)</option>
        <option value="title desc" {% if request.params.get('sort') == 'title desc' %}selected{% endif %}>İsim (Z-A)</option>
        <option value="package_count desc" {% if request.params.get('sort') == 'package_count desc' %}selected{% endif %}>En Çok Veri Seti</option>
        <option value="package_count asc" {% if request.params.get('sort') == 'package_count asc' %}selected{% endif %}>En Az Veri Seti</option>
      </select>
    </div>
    
    <!-- Sayfa başına gösterim -->
    <div style="flex: 1; min-width: 120px;">
      <select name="limit" class="form-control" id="items-per-page">
        <option value="5" {% if request.params.get('limit', '20')|string == '5' %}selected{% endif %}>5'li</option>
        <option value="10" {% if request.params.get('limit', '20')|string == '10' %}selected{% endif %}>10'lu</option>
        <option value="20" {% if request.params.get('limit', '20')|string == '20' %}selected{% endif %}>20'li</option>
      </select>
    </div>
    
    <!-- Gizli alanlar - mevcut sayfa durumunu korumak için -->
    {% for key, value in request.params.items() %}
      {% if key not in ['q', 'sort', 'limit', 'page'] %}
        <input type="hidden" name="{{ key }}" value="{{ value }}">
      {% endif %}
    {% endfor %}
  </form>
  
  {% block organizations_list %}
    {% if page.items or request.params %}
      {% if page.items %}
        {% snippet "organization/snippets/organization_list.html", organizations=page.items %}
      {% endif %}
    {% else %}
      <p class="empty">
        {{ _('There are currently no organizations for this site') }}.
        {% if h.check_access('organization_create') %}
          {% link_for _('How about creating one?'), named_route=group_type+'.new' %}</a>.
        {% endif %}
      </p>
    {% endif %}
  {% endblock %}
  
  {% block page_pagination %}
    {{ page.pager(q=request.params.get('q', ''), sort=request.params.get('sort', ''), limit=request.params.get('limit', '20')) }}
  {% endblock %}
{% endblock %}

{% block secondary_content %}
  <!-- Boş bırakıldı çünkü helper yukarıya taşındı -->
{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('organization-filter-form');
    const searchInput = document.getElementById('search-organizations');
    const sortSelect = document.getElementById('sort-select');
    const itemsSelect = document.getElementById('items-per-page');
    
    let searchTimeout;
    
    // Arama için gecikme ile form gönderimi
    function handleSearchInput() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(function() {
            // Sayfa numarasını sıfırla
            removePageParam();
            form.submit();
        }, 500);
    }
    
    // Diğer değişiklikler için anında form gönderimi
    function handleInstantChange() {
        // Sayfa numarasını sıfırla
        removePageParam();
        form.submit();
    }
    
    // Sayfa parametresini kaldır
    function removePageParam() {
        const pageInput = form.querySelector('input[name="page"]');
        if (pageInput) {
            pageInput.remove();
        }
    }
    
    // Event listener'ları ekle
    if (searchInput) {
        searchInput.addEventListener('input', handleSearchInput);
    }
    
    if (sortSelect) {
        sortSelect.addEventListener('change', handleInstantChange);
    }
    
    if (itemsSelect) {
        itemsSelect.addEventListener('change', handleInstantChange);
    }
    
    // Form gönderildiğinde loading göstergesi (opsiyonel)
    form.addEventListener('submit', function() {
        const submitButton = form.querySelector('button[type="submit"]');
        if (submitButton) {
            submitButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Yükleniyor...';
            submitButton.disabled = true;
        }
    });
});
</script>

<style>
/* En yüksek öncelik için body de ekliyoruz */
body div.row.wrapper:before {
  content: none !important;
  display: none !important;
}
div.row.wrapper:before{display:none!important;content:none!important}

.wrapper:before {
    content: '';
    display: none !important;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    width: 25%;
    border-right: 1px solid #ddd;
    z-index: 1;
}

div.row.wrapper:before {
  display: none !important;   /* görünmez yap */
  content: none !important;   /* varsa içeriği temizle */
}

@media (min-width: 768px) {
    .col-sm-9 {
         width: 100% !important; 
    }
}

body.page-organization aside.secondary.col-sm-3 {
  display: none !important;
}

.organizations-info .module {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
}

.search-and-filters {
    background: #fff;
    padding: 20px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    transition: all 0.2s ease;
}

.search-and-filters:hover {
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.search-and-filters .form-control {
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    padding: 10px 15px;
    transition: all 0.2s ease;
    font-size: 14px;
}

.search-and-filters .form-control:focus {
    border-color: #4f46e5;
    outline: none;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

/* Responsive tasarım */
@media (max-width: 768px) {
    .search-and-filters {
        flex-direction: column;
        gap: 10px !important;
    }
    
    .search-and-filters > div {
        width: 100% !important;
        flex: none !important;
        min-width: auto !important;
    }
}

.media-grid {
    padding-left: 0;
    margin: 0;
    list-style: none;
    min-height: 240px !important;
    padding-top: 15px;
    background: none;
    border: 1px solid #ddd;
    border-width: 1px 0;
}

/* Loading durumu için stil */
.form-control:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Arama input'u için özel stil */
#search-organizations {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23666" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 40px;
}
</style>