{% extends "package/base.html" %}

{% set logged_in = true if c.userobj else false %}
{% set res = resource %}

{% block head_extras %}
  {{ super() }}
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow-modern: 0 20px 40px rgba(0, 0, 0, 0.1);
      --neon-glow: 0 0 30px rgba(102, 126, 234, 0.4);
    }

    .modern-edit-layout {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem 0;
    }

    .modern-breadcrumb {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 1rem 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .modern-breadcrumb ol {
      margin: 0;
      padding: 0;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .modern-breadcrumb li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
    }

    .modern-breadcrumb li.active {
      color: white;
      font-weight: 600;
    }

    .modern-breadcrumb a {
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      transition: all 0.3s ease;
      padding: 0.3rem 0.8rem;
      border-radius: 8px;
    }

    .modern-breadcrumb a:hover {
      color: white;
      background: rgba(255, 255, 255, 0.1);
      text-decoration: none;
    }

    .breadcrumb-separator {
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.8rem;
    }

    .content-actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .action-btn-modern {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 15px;
      padding: 0.8rem 1.5rem;
      color: white;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .action-btn-modern:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: var(--neon-glow);
      color: white;
      text-decoration: none;
    }

    .action-btn-modern.primary {
      background: var(--secondary-gradient);
      border-color: transparent;
    }

    .primary-nav-modern {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 0;
      margin-bottom: 2rem;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .nav-tabs-modern {
      display: flex;
      margin: 0;
      padding: 0;
      list-style: none;
      border: none;
      background: none;
    }

    .nav-item-modern {
      flex: 1;
    }

    .nav-link-modern {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1.2rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      background: none;
      position: relative;
      overflow: hidden;
    }

    .nav-link-modern::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--primary-gradient);
      transition: left 0.4s ease;
      z-index: 1;
    }

    .nav-link-modern.active::before {
      left: 0;
    }

    .nav-link-modern.active {
      color: white;
      background: var(--primary-gradient);
    }

    .nav-link-modern:hover {
      color: white;
      background: rgba(255, 255, 255, 0.1);
      text-decoration: none;
    }

    .nav-link-modern span {
      position: relative;
      z-index: 2;
    }

    .nav-link-modern i {
      position: relative;
      z-index: 2;
    }

    .main-content-card {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 25px;
      padding: 2rem;
      box-shadow: var(--shadow-modern);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .main-content-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-gradient);
    }

    .main-content-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--neon-glow), var(--shadow-modern);
    }

    .content-header {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .content-title {
      color: white;
      font-size: 2rem;
      font-weight: 700;
      margin: 0;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .sidebar-modern {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      margin-bottom: 2rem;
    }

    .sidebar-modern:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .sidebar-title {
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .modern-edit-layout {
        padding: 1rem 0;
      }

      .modern-breadcrumb {
        padding: 1rem;
        margin: 0 1rem 2rem 1rem;
      }

      .content-actions {
        margin: 0 1rem 2rem 1rem;
        flex-direction: column;
      }

      .primary-nav-modern {
        margin: 0 1rem 2rem 1rem;
      }

      .nav-tabs-modern {
        flex-direction: column;
      }

      .main-content-card {
        margin: 0 1rem;
        padding: 1.5rem;
      }

      .sidebar-modern {
        margin: 0 1rem 2rem 1rem;
      }

      .content-title {
        font-size: 1.5rem;
      }
    }

    /* Animations */
    @keyframes slideInFromTop {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modern-breadcrumb,
    .content-actions,
    .primary-nav-modern {
      animation: slideInFromTop 0.6s ease-out;
    }

    .main-content-card {
      animation: slideInFromTop 0.8s ease-out;
    }

    .sidebar-modern {
      animation: slideInFromTop 1s ease-out;
    }

    /* Loading states */
    .loading-placeholder {
      background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 100%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
      height: 20px;
      margin-bottom: 10px;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
  </style>
{% endblock %}

{% block breadcrumb_content_selected %}{% endblock %}

{% block breadcrumb_content %}
<div class="modern-breadcrumb">
  <ol>
    <li><a href="{{ h.url_for('home.index') }}"><i class="fa fa-home"></i></a></li>
    <li><span class="breadcrumb-separator"><i class="fa fa-chevron-right"></i></span></li>
    <li><a href="{{ h.url_for('dataset.search') }}">{{ _('Datasets') }}</a></li>
    <li><span class="breadcrumb-separator"><i class="fa fa-chevron-right"></i></span></li>
    <li><a href="{{ h.url_for(pkg.type ~ '.read', id=pkg.name) }}">{{ h.dataset_display_name(pkg)|truncate(30) }}</a></li>
    {% if res %}
      <li><span class="breadcrumb-separator"><i class="fa fa-chevron-right"></i></span></li>
      <li><a href="{{ h.url_for(pkg.type ~ '_resource.read', id=pkg.name, resource_id=res.id) }}">{{ h.resource_display_name(res)|truncate(30) }}</a></li>
      <li><span class="breadcrumb-separator"><i class="fa fa-chevron-right"></i></span></li>
      <li{% block breadcrumb_edit_selected %} class="active"{% endblock %}><span>{{ _('Edit') }}</span></li>
    {% endif %}
  </ol>
</div>
{% endblock %}

{% block content_action %}
<div class="content-actions">
  <a href="{{ h.url_for(pkg.type ~ '.resources', id=pkg.name) }}" class="action-btn-modern">
    <i class="fa fa-arrow-left"></i>
    {{ _('All Resources') }}
  </a>
  {% if res %}
    <a href="{{ h.url_for(pkg.type ~ '_resource.read', id=pkg.name, resource_id=res.id) }}" class="action-btn-modern primary">
      <i class="fa fa-eye"></i>
      {{ _('View Resource') }}
    </a>
  {% endif %}
</div>
{% endblock %}

{% block content_primary_nav %}
<div class="primary-nav-modern">
  <ul class="nav-tabs-modern">
    <li class="nav-item-modern">
      <a class="nav-link-modern {{ 'active' if request.endpoint.endswith('.edit') }}" 
         href="{{ h.url_for(pkg.type ~ '_resource.edit', id=pkg.name, resource_id=res.id) }}">
        <i class="fa fa-pencil-square-o"></i>
        <span>{{ _('Edit Resource') }}</span>
      </a>
    </li>
    {% block inner_primary_nav %}{% endblock %}
    <li class="nav-item-modern">
      <a class="nav-link-modern {{ 'active' if request.endpoint.endswith('.views') }}" 
         href="{{ h.url_for(pkg.type ~ '_resource.views', id=pkg.name, resource_id=res.id) }}">
        <i class="fa fa-chart-bar"></i>
        <span>{{ _('Views') }}</span>
      </a>
    </li>
  </ul>
</div>
{% endblock %}

{% block content %}
<div class="modern-edit-layout">
  <div class="container">
    {% block breadcrumb_content %}{% endblock %}
    {% block content_action %}{% endblock %}
    {% block content_primary_nav %}{% endblock %}
    
    <div class="row">
      <div class="col-md-8">
        <div class="main-content-card">
          {% block primary_content_inner %}
            <div class="content-header">
              <h1 class="content-title">{% block form_title %}{{ _('Edit Resource') }}{% endblock %}</h1>
            </div>
            {% block form %}{% endblock %}
          {% endblock %}
        </div>
      </div>
      
      <div class="col-md-4">
        {% block secondary_content %}
          <div class="sidebar-modern">
            <h3 class="sidebar-title">
              <i class="fa fa-info-circle"></i>
              {{ _('Resource Information') }}
            </h3>
            {% snippet 'package/snippets/resource_info.html', res=res %}
          </div>
        {% endblock %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  {% asset 'vendor/fileupload' %}
  
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add interactive navigation effects
    const navLinks = document.querySelectorAll('.nav-link-modern');
    navLinks.forEach(link => {
      link.addEventListener('mouseenter', function() {
        if (!this.classList.contains('active')) {
          this.style.background = 'rgba(255, 255, 255, 0.1)';
        }
      });
      
      link.addEventListener('mouseleave', function() {
        if (!this.classList.contains('active')) {
          this.style.background = 'none';
        }
      });
    });

    // Add form validation feedback
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
      form.addEventListener('submit', function(e) {
        const submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> ' + submitBtn.textContent;
          submitBtn.disabled = true;
        }
      });
    });

    // Add smooth scroll for navigation
    const anchorLinks = document.querySelectorAll('a[href^="#"]');
    anchorLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          e.preventDefault();
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Add loading states for async actions
    const asyncButtons = document.querySelectorAll('[data-loading]');
    asyncButtons.forEach(button => {
      button.addEventListener('click', function() {
        const loadingText = this.dataset.loading || 'Loading...';
        const originalText = this.innerHTML;
        
        this.innerHTML = '<i class="fa fa-spinner fa-spin"></i> ' + loadingText;
        this.disabled = true;
        
        // Re-enable after 5 seconds as fallback
        setTimeout(() => {
          this.innerHTML = originalText;
          this.disabled = false;
        }, 5000);
      });
    });
  });
  </script>
{% endblock %}