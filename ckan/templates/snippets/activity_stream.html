<style>
  Â  .modern-activity-table tbody tr {
  Â  height: auto !important; /* Otomatik yÃ¼kseklik */
  }
  /* Main Layout Container */
  .activity-main-layout {
  Â  display: block !important; /* Flex yerine block yapÄ±ldÄ± */
  Â  width: 100% !important;
  Â  max-width: 1400px !important;
  Â  margin: 0 auto !important;
  Â  padding: 20px !important;
  }
  
  /* Sidebar tamamen kaldÄ±rÄ±ldÄ±ÄŸÄ± iÃ§in ilgili CSS'ler Ã¶nemsizleÅŸti */
  .activity-filter-sidebar {
  Â  display: none !important; /* Sidebar tamamen gizlendi */
  }
  
  /* Modern Activity Stream Styles */
  .modern-activity-container {
  Â  background: #ffffff !important;
  Â  border-radius: 12px !important;
  Â  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
  Â  overflow: auto !important; /* Tablonun yatay kaydÄ±rmasÄ± iÃ§in auto yapÄ±ldÄ± */
  Â  flex: 1 !important;
  }
  
  .activity-header {
  Â  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  Â  color: white !important;
  Â  padding: 20px 24px !important;
  Â  border-bottom: none !important;
  }
  
  .activity-header h3 {
  Â  margin: 0 !important;
  Â  font-size: 18px !important;
  Â  font-weight: 600 !important;
  Â  display: flex !important;
  Â  align-items: center !important;
  Â  gap: 10px !important;
  }
  
  .activity-header h3:before {
  Â  content: "âš¡" !important;
  Â  font-size: 20px !important;
  }
  
  .modern-activity-table {
  Â  width: 100% !important;
  Â  border-collapse: collapse !important;
  Â  background: white !important;
  Â  margin: 0 !important;
  Â  table-layout: auto !important; /* SÃ¼tun geniÅŸlikleri dinamikleÅŸsin */
    min-width: 800px; /* Ã‡ok fazla sÃ¼tun varsa yatay kaydÄ±rma iÃ§in minimum geniÅŸlik */
  }
  
  /* Eski sabit sÃ¼tun geniÅŸlikleri kaldÄ±rÄ±ldÄ±, dinamik iÃ§eriÄŸe gÃ¶re ayarlansÄ±n */
  .modern-activity-table th,
  .modern-activity-table td {
      padding: 16px 20px !important;
      text-align: left !important;
      vertical-align: top !important; /* Ä°Ã§erik Ã¼ste hizalansÄ±n */
      font-size: 14px !important;
      line-height: 1.5 !important;
      border-bottom: 1px solid #f1f5f9 !important;
      word-break: break-word; /* Uzun kelimeleri kÄ±rma */
  }
  
  .modern-activity-table thead {
  Â  background: #f8fafc !important;
  Â  border-bottom: 2px solid #e2e8f0 !important;
  }
  
  .modern-activity-table th {
  Â  font-weight: 600 !important;
  Â  color: #475569 !important;
  Â  text-transform: uppercase !important;
  Â  letter-spacing: 0.5px !important;
  Â  border: none !important;
  }
  
  .modern-activity-table tbody tr {
  Â  transition: all 0.2s ease !important;
  }
  
  .modern-activity-table tbody tr:hover {
  Â  background: #f8fafc !important;
  Â  transform: none !important; /* Hover efekti kaldÄ±rÄ±ldÄ± */
  Â  box-shadow: none !important; /* Hover efekti kaldÄ±rÄ±ldÄ± */
  }
  
  .modern-activity-table tbody tr:last-child {
  Â  border-bottom: none !important;
  }
  
  /* Bu kÄ±sÄ±m artÄ±k kullanÄ±lmÄ±yor, kaldÄ±rÄ±ldÄ±:
  .modern-activity-table tbody tr.hidden {
  Â  display: table-row !important;
  }
  */
  
  /* DiÄŸer CSS kurallarÄ± aynen kalsÄ±n veya ihtiyaca gÃ¶re dÃ¼zenlensin */
  /* Stil dÃ¼zeltmelerinin Ã§oÄŸu geÃ§erliliÄŸini koruyor */
  
  /* Remove list markers and styling */
  .activity-object li {
  Â  list-style: none !important;
  Â  list-style-type: none !important;
  Â  margin: 0 !important;
  Â  padding: 0 !important;
  }
  
  .activity-object li::marker {
  Â  display: none !important;
  Â  content: none !important;
  }
  
  .activity-object ul, .activity-object ol {
  Â  list-style: none !important;
  Â  padding: 0 !important;
  Â  margin: 0 !important;
  }
  
  
  /* Responsive Design */
  @media (max-width: 1200px) {
  Â  .activity-main-layout {
  Â  Â  flex-direction: column !important;
  Â  }
  Â  
  Â  .activity-filter-sidebar {
  Â  Â  width: 100% !important;
  Â  Â  min-width: auto !important;
  Â  Â  position: relative !important;
  Â  Â  top: auto !important;
  Â  }
  Â  
  Â  .sidebar-content {
  Â  Â  padding: 20px !important;
  Â  }
  Â  
  Â  /* Bu sÄ±nÄ±flara sahip elemanlar artÄ±k yok, kaldÄ±rÄ±ldÄ± */
  Â  /*
  Â  .activity-type-filters,
  Â  .time-range-filters,
  Â  .user-filters {
  Â  Â  flex-direction: column !important;
  Â  Â  flex-wrap: nowrap !important;
  Â  }
  Â  
  Â  .activity-type-option,
  Â  .time-range-option,
  Â  .user-filter-option {
  Â  Â  flex: none !important;
  Â  Â  min-width: auto !important;
  Â  }
  Â  */
  }
  
  @media (max-width: 768px) {
  Â  .modern-activity-table th,
  Â  .modern-activity-table td {
  Â  Â  padding: 10px 12px !important; /* Daha kÃ¼Ã§Ã¼k padding */
  Â  Â  font-size: 12px !important;
  Â  }
  Â  
  Â  .activity-header {
  Â  Â  padding: 12px 16px !important;
  Â  }
  Â  
  Â  .activity-header h3 {
  Â  Â  font-size: 15px !important;
  Â  }
  Â  
  Â  /* Bu sÄ±nÄ±flara sahip elemanlar artÄ±k yok, kaldÄ±rÄ±ldÄ± */
  Â  /*
  Â  .activity-icon {
  Â  Â  width: 24px !important;
  Â  Â  height: 24px !important;
  Â  Â  font-size: 10px !important;
  Â  }
  Â  */
  Â  
  Â  /* Bu sÄ±nÄ±flara sahip elemanlar artÄ±k yok, kaldÄ±rÄ±ldÄ± */
  Â  /*
  Â  .activity-type-filters,
  Â  .time-range-filters,
  Â  .user-filters {
  Â  Â  flex-direction: column !important;
  Â  }
  Â  */
  Â  
  Â  /* Pagination artÄ±k tamamen gizlendiÄŸi iÃ§in bu kÄ±sÄ±m da Ã¶nemsizleÅŸti */
  Â  .pagination-container {
  Â  Â  flex-direction: column !important;
  Â  Â  align-items: stretch !important;
  Â  Â  gap: 10px !important;
  Â  Â  padding: 15px !important;
  Â  }
  Â  
  Â  .pagination-controls {
  Â  Â  justify-content: center !important;
  Â  Â  flex-wrap: wrap !important;
  Â  }
  }
  
  @media (max-width: 480px) {
  Â  .modern-activity-table {
  Â  Â  font-size: 11px !important;
  Â  }
  }
  </style>
  
  {# Displays an activity stream with filters
  
  activity_stream - the activity data. e.g. the output from package_activity_list
  id - the id or current name of the object (e.g. package name, user id)
  object_type - 'package', 'organization', 'group', 'user'
  
  #}
  {% block activity_stream %}
  {# Makrolar aynen kalabilir, Ã§Ã¼nkÃ¼ activity nesnesi hala aynÄ± ÅŸekilde kullanÄ±lacak #}
  {% macro actor(activity) %}
  Â  <span class="actor">
  Â  Â  {{ h.linked_user(activity.user_id, 0, 30) }}
  Â  </span>
  {% endmacro %}
  
  {% macro dataset(activity) %}
  Â  {% set dataset_type = activity.data.package.type if activity.data.package and activity.data.package.type else 'dataset' %}
  Â  <span class="dataset">
  Â  Â  {{ h.link_to(activity.data.package.title if activity.data.package and activity.data.package.title else _('unknown'),
  Â  Â  Â  h.url_for(dataset_type ~ '.read', id=activity.object_id)) }}
  Â  </span>
  {% endmacro %}
  
  {% macro organization(activity) %}
  Â  {{ h.link_to(activity.data.group.title if activity.data.group and activity.data.group.title else _('unknown'),
  Â  Â  Â  Â  Â  Â  Â  Â h.url_for('organization.read', id=activity.object_id)) }}
  {% endmacro %}
  
  {% macro user(activity) %}
  <span class="actor">
  Â  {{ h.linked_user(activity.object_id, 0, 20) }}
  </span>
  {% endmacro %}
  
  {% macro group(activity) %}
  <span class="group">
  Â  {{ h.link_to(activity.data.group.title if activity.data.group and activity.data.group.title else _('unknown'),
  Â  Â  Â  Â  Â  Â  Â  Â h.url_for('group.read', id=activity.object_id)) }}
  </span>
  {% endmacro %}
  
  
  {% set can_show_activity_detail = h.check_access('activity_list', {'id': id, 'include_data': True, 'object_type': object_type}) %}
  
  <div class="activity-main-layout">
  Â  Â  <div class="activity-filter-sidebar" style="display: none;">
  Â  Â  Â  </div>
  
  Â  Â  <div class="modern-activity-container">
  Â  Â  <div class="activity-header">
  Â  Â  Â  <h3>TÃ¼m Aktiviteler (Backend'den Gelen Eksiksiz Veri)</h3>
  Â  Â  </div>
  Â  Â  
  Â  Â  {% if activity_stream %}
  Â  Â  Â  <table class="modern-activity-table">
  Â  Â  Â  Â  <thead>
  Â  Â  Â  Â  Â  <tr id="activity-table-header-row">
  Â  Â  Â  Â  Â  Â  {# SÃ¼tun baÅŸlÄ±klarÄ± dinamik olarak JavaScript tarafÄ±ndan doldurulacak #}
  Â  Â  Â  Â  Â  </tr>
  Â  Â  Â  Â  </thead>
  Â  Â  Â  Â  <tbody id="activity-table-body">
  Â  Â  Â  Â  Â  {# Jinja2 ile gelen veriyi iÅŸleyip tabloya basÄ±yoruz - JS tarafÄ±ndan doldurulacak #}
  Â  Â  Â  Â  </tbody>
  Â  Â  Â  </table>
  Â  Â  Â  
  Â  Â  Â  Â  Â  Â  <div class="pagination-container" style="display: none;">
  Â  Â  Â  Â  <div class="pagination-info" id="pagination-info"></div>
  Â  Â  Â  Â  <div class="pagination-controls">
  Â  Â  Â  Â  Â  <div class="pagination-buttons" id="pagination-buttons"></div>
  Â  Â  Â  Â  </div>
  Â  Â  Â  </div>
  Â  Â  {% else %}
  Â  Â  Â  <div class="activity-empty">
  Â  Â  Â  Â  <div class="activity-empty-icon">ğŸ“Š</div>
  Â  Â  Â  Â  <div class="activity-empty-text">HenÃ¼z aktivite yok</div>
  Â  Â  Â  Â  <div class="activity-empty-description">Aktiviteler burada gÃ¶rÃ¼necek</div>
  Â  Â  Â  </div>
  Â  Â  {% endif %}
  Â  </div>
  </div>
  
  <script>
  document.addEventListener('DOMContentLoaded', function() {
      // activity_stream verisi, Jinja2'den doÄŸrudan bir JavaScript deÄŸiÅŸkenine aktarÄ±lÄ±r.
      // Bu, CKAN'Ä±n Python tarafÄ±nda `activity_stream` adÄ±nda bir deÄŸiÅŸkende
      // aktivite verilerini saÄŸladÄ±ÄŸÄ±nÄ± varsayarÄ±z.
      const activityStream = {{ activity_stream | tojson }};
  
      const tableBody = document.getElementById('activity-table-body');
      const tableHeaderRow = document.getElementById('activity-table-header-row');
  
      if (!activityStream || activityStream.length === 0) {
          // EÄŸer aktivite akÄ±ÅŸÄ± boÅŸsa, JS tarafÄ±nda ekstra bir iÅŸlem yapmaya gerek yok,
          // Jinja'nÄ±n {% else %} bloÄŸu zaten bu durumu yÃ¶netiyor.
          return;
      }
  
      // --- SÃ¼tun BaÅŸlÄ±klarÄ±nÄ± Dinamik Olarak OluÅŸtur ---
      // TÃ¼m aktivitelerdeki benzersiz anahtarlarÄ± topla
      let allKeys = new Set();
      activityStream.forEach(activity => {
          Object.keys(activity).forEach(key => allKeys.add(key));
          // activity.data bir nesne ise, iÃ§indeki anahtarlarÄ± da 'data.key' formatÄ±nda ekleyelim
          if (typeof activity.data === 'object' && activity.data !== null) {
              Object.keys(activity.data).forEach(dataKey => allKeys.add('data.' + dataKey));
          } else if (typeof activity.data === 'string') {
              // EÄŸer activity.data bir JSON string ise parse etmeye Ã§alÄ±ÅŸalÄ±m
              try {
                  const parsedData = JSON.parse(activity.data);
                  if (typeof parsedData === 'object' && parsedData !== null) {
                      Object.keys(parsedData).forEach(dataKey => allKeys.add('data.' + dataKey));
                  }
              } catch (e) {
                  // JSON parse hatasÄ± varsa, data'yÄ± sadece bir 'data' sÃ¼tunu olarak ele alacaÄŸÄ±z
                  allKeys.add('data');
              }
          }
      });
  
      // GÃ¶sterilmesini istemediÄŸimiz bazÄ± anahtarlar (CKAN iÃ§sel veya anlamsÄ±z)
      const excludedKeys = new Set([
          '__extras',
          'validated_data',
          'object_type', // Nesne tipi ve ID'sini birleÅŸtirip daha anlamlÄ± hale getirebiliriz
          'object_id',
          'activity_type', // Daha anlamlÄ± bir "Aktivite" sÃ¼tunu oluÅŸturacaÄŸÄ±z
          'user_id', // KullanÄ±cÄ± ID'si yerine kullanÄ±cÄ± adÄ±nÄ± Ã§ekeceÄŸiz
          // DiÄŸer CKAN Ã¶zel/iÃ§sel anahtarlarÄ±:
          'revision_id',
          'data' // 'data.key' olarak detaylarÄ± alacaÄŸÄ±mÄ±z iÃ§in ana 'data' sÃ¼tununu kaldÄ±rÄ±yoruz
      ]);
  
      // KullanÄ±cÄ± adlarÄ± iÃ§in bir cache oluÅŸturalÄ±m
      const userCache = {};
      const userPromises = [];
  
      // CKAN API'sinden kullanÄ±cÄ± adÄ±nÄ± Ã§eker
      // Bu fonksiyon, aynÄ± zamanda cache'i gÃ¼nceller ve Promise dÃ¶ndÃ¼rÃ¼r.
      async function fetchUsername(userId) {
          if (!userId) return 'Bilinmiyor';
          if (userCache[userId]) return userCache[userId];
  
          try {
              // CKAN API Endpoint'i iÃ§in gÃ¶receli URL kullanÄ±yoruz.
              // Sunucu adresini belirtmeye gerek yok.
              const response = await fetch(`/api/3/action/user_show`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  credentials: 'include', // Oturum Ã§erezlerini gÃ¶nderir
                  body: JSON.stringify({ id: userId })
              });
              const data = await response.json();
              if (data.success && data.result) {
                  const username = data.result.name || data.result.display_name || 'Bilinmiyor';
                  userCache[userId] = username;
                  return username;
              }
          } catch (error) {
              console.warn(`KullanÄ±cÄ± ID ${userId} bilgisi Ã§ekilemedi:`, error);
          }
          userCache[userId] = 'Bilinmiyor'; // Hata durumunda da cache'e ekle
          return 'Bilinmiyor';
      }
  
      // BaÅŸlÄ±k hÃ¼cresi iÃ§in gÃ¶sterim sÄ±rasÄ± ve baÅŸlÄ±klar
      const customHeaders = {
          'timestamp': 'Zaman',
          'user_display_name': 'KullanÄ±cÄ±', // Yeni oluÅŸturacaÄŸÄ±mÄ±z kullanÄ±cÄ± adÄ± sÃ¼tunu
          'activity_details': 'Aktivite DetayÄ±', // Aktivite tipi ve nesne detaylarÄ±nÄ± birleÅŸtireceÄŸimiz sÃ¼tun
          'object_type': 'Nesne Tipi', // EÄŸer ayrÄ± bir sÃ¼tun olarak tutmak istersek
          'object_id': 'Nesne ID', // EÄŸer ayrÄ± bir sÃ¼tun olarak tutmak istersek
          // DiÄŸer 'data.' ile baÅŸlayanlar dinamik olacak
      };
  
      // Belirli bir sÄ±ralama belirleyelim, geri kalanlar alfabetik olsun
      const preferredOrder = [
          'timestamp', 'user_display_name', 'activity_details'
          // 'object_type', 'object_id' gibi daha fazla sÃ¼tunu buraya ekleyebilirsiniz
      ];
  
      // `allKeys` kÃ¼mesindeki anahtarlarÄ± sÄ±rala
      let sortedKeys = Array.from(allKeys).filter(key => !excludedKeys.has(key));
      sortedKeys.sort((a, b) => {
          const indexA = preferredOrder.indexOf(a);
          const indexB = preferredOrder.indexOf(b);
  
          // EÄŸer ikisi de tercih edilen sÄ±rada deÄŸilse alfabetik sÄ±rala
          if (indexA === -1 && indexB === -1) {
              return a.localeCompare(b);
          }
          // Sadece biri tercih edilen sÄ±radaysa, onu Ã¶ne al
          if (indexA === -1) return 1;
          if (indexB === -1) return -1;
          // Ä°kisi de tercih edilen sÄ±radaysa, sÄ±rasÄ±na gÃ¶re sÄ±rala
          return indexA - indexB;
      });
  
      // Custom header'larÄ± preferredOrder'Ä±n baÅŸÄ±na ekleyerek nihai sÄ±rayÄ± oluÅŸtur
      const finalHeaders = preferredOrder.filter(header => Object.keys(customHeaders).includes(header))
                              .concat(sortedKeys.filter(key => !preferredOrder.includes(key)));
  
      // Dinamik sÃ¼tun baÅŸlÄ±klarÄ±nÄ± oluÅŸtur
      const headerHtml = finalHeaders.map(key => {
          let displayKey = customHeaders[key] || key.replace(/_/g, ' '); // Ã–zel baÅŸlÄ±k varsa onu kullan, yoksa alt Ã§izgileri dÃ¼zelt
          if (key.startsWith('data.')) {
              displayKey = 'Detay: ' + displayKey.substring(5).replace(/_/g, ' '); // 'data.' prefix'ini kaldÄ±rÄ±p dÃ¼zelt
          }
          return `<th>${displayKey.charAt(0).toUpperCase() + displayKey.slice(1)}</th>`; // Ä°lk harfi bÃ¼yÃ¼t
      }).join('');
      tableHeaderRow.innerHTML = headerHtml;
  
      // KullanÄ±cÄ± adlarÄ±nÄ± Ã¶nceden Ã§ekmek iÃ§in tÃ¼m user_id'leri topla
      const uniqueUserIds = new Set(activityStream.map(activity => activity.user_id).filter(id => id && id !== 'null'));
      uniqueUserIds.forEach(userId => {
          userPromises.push(fetchUsername(userId));
      });
  
      // TÃ¼m kullanÄ±cÄ± adlarÄ± Ã§ekildikten sonra tabloyu render et
      Promise.all(userPromises).then(() => {
          tableBody.innerHTML = ''; // Mevcut iÃ§eriÄŸi temizle
  
          activityStream.forEach(activity => {
              const tr = document.createElement('tr');
  
              finalHeaders.forEach(headerKey => {
                  const td = document.createElement('td');
                  let cellContent = '';
  
                  if (headerKey === 'user_display_name') {
                      cellContent = userCache[activity.user_id] || activity.user_id || 'Bilinmiyor';
                  } else if (headerKey === 'timestamp') {
                      cellContent = activity.timestamp ? new Date(activity.timestamp).toLocaleString('tr-TR') : '<span style="color:#9b98a7;font-style:italic;">Yok</span>';
                  } else if (headerKey === 'activity_details') {
                      // Bu sÃ¼tunda Aktivite Tipi ve Nesne bilgisini birleÅŸtiriyoruz
                      let objectLinkHtml = '';
                      let activityTypeTranslated = '';
  
                      const activityType = activity.activity_type ? activity.activity_type.replace(/_/g, ' ').toLowerCase() : 'unknown';
  
                      // Basit Ã§eviriler (daha kapsamlÄ± Ã§eviri iÃ§in CKAN i18n helperlarÄ± kullanÄ±lmalÄ±)
                      if (activityType.includes('new') || activityType.includes('created')) {
                          activityTypeTranslated = 'Yeni OluÅŸturuldu';
                          td.innerHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="activity-icon created">+</div> <span style="font-weight: 600; color: #059669;">${activityTypeTranslated}</span></div>`;
                      } else if (activityType.includes('changed') || activityType.includes('updated')) {
                          activityTypeTranslated = 'GÃ¼ncellendi';
                          td.innerHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="activity-icon updated">âœ</div> <span style="font-weight: 600; color: #3b82f6;">${activityTypeTranslated}</span></div>`;
                      } else if (activityType.includes('deleted')) {
                          activityTypeTranslated = 'Silindi';
                          td.innerHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="activity-icon deleted">Ã—</div> <span style="font-weight: 600; color: #ef4444;">${activityTypeTranslated}</span></div>`;
                      } else if (activityType.includes('follow')) {
                          activityTypeTranslated = 'Takip Edildi';
                          td.innerHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="activity-icon follow">â™¥</div> <span style="font-weight: 600; color: #f59e0b;">${activityTypeTranslated}</span></div>`;
                      } else {
                          activityTypeTranslated = activity.activity_type ? activity.activity_type.replace(/_/g, ' ') : 'Bilinmiyor';
                          td.innerHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="activity-icon default">â€¢</div> <span style="font-weight: 600; color: #6b7280;">${activityTypeTranslated.charAt(0).toUpperCase() + activityTypeTranslated.slice(1)}</span></div>`;
                      }
                      td.innerHTML += `<div class="activity-description">${userCache[activity.user_id] || activity.user_id || 'Bilinmiyor'} tarafÄ±ndan</div>`;
  
  
                      // Nesne tipi ve ID'sine gÃ¶re link oluÅŸtur
                      if (activity.object_type === 'package') {
                          const pkg = activity.data.package || {}; // EÄŸer data.package yoksa boÅŸ obje
                          objectLinkHtml = `<span class="activity-object"><a href="/dataset/${pkg.name || activity.object_id}" class="activity-action-btn view">ğŸ‘ï¸ ${pkg.title || pkg.name || _('unknown dataset')}</a></span>`;
                      } else if (activity.object_type === 'organization' || activity.object_type === 'group') {
                          const group = activity.data.group || {}; // EÄŸer data.group yoksa boÅŸ obje
                          const urlPrefix = activity.object_type === 'organization' ? '/organization/' : '/group/';
                          objectLinkHtml = `<span class="activity-object"><a href="${urlPrefix}${group.name || activity.object_id}" class="activity-action-btn view">ğŸ‘ï¸ ${group.title || group.name || _('unknown ' + activity.object_type)}</a></span>`;
                      } else if (activity.object_type === 'user') {
                          objectLinkHtml = `<span class="activity-object"><a href="/user/${activity.object_id}" class="activity-action-btn view">ğŸ‘ï¸ ${userCache[activity.object_id] || activity.object_id || _('unknown user')}</a></span>`;
                      } else {
                           // DiÄŸer objeler iÃ§in sadece ID veya tip gÃ¶ster
                          objectLinkHtml = `<span class="activity-object">${activity.object_type ? activity.object_type.charAt(0).toUpperCase() + activity.object_type.slice(1) + ': ' : ''}${activity.object_id || _('unknown object')}</span>`;
                      }
                      td.innerHTML += objectLinkHtml;
                  }
                  else if (headerKey.startsWith('data.')) {
                      // data.key'leri Ã¶zel olarak iÅŸle
                      const dataKey = headerKey.substring(5);
                      try {
                          let dataValue;
                          if (typeof activity.data === 'string') {
                              // EÄŸer activity.data bir JSON string ise parse et
                              const parsedData = JSON.parse(activity.data);
                              dataValue = parsedData[dataKey];
                          } else if (typeof activity.data === 'object' && activity.data !== null) {
                              // Zaten bir obje ise doÄŸrudan eriÅŸ
                              dataValue = activity.data[dataKey];
                          }
                          
                          if (dataValue !== undefined && dataValue !== null) {
                              if (typeof dataValue === 'object') {
                                  cellContent = `<pre>${JSON.stringify(dataValue, null, 2)}</pre>`;
                              } else if (typeof dataValue === 'boolean') {
                                  cellContent = dataValue ? 'Evet' : 'HayÄ±r';
                              }
                              else {
                                  cellContent = dataValue.toString();
                              }
                          } else {
                              cellContent = '<span style="color:#9b98a7;font-style:italic;">Yok</span>';
                          }
                      } catch (e) {
                          cellContent = `<span style="color:red;font-style:italic;">Veri hatasÄ± (JSON parse hatasÄ±)</span>`;
                          console.error('JSON parse hatasÄ±:', e, activity.data);
                      }
                      td.innerHTML = cellContent;
                  } else if (activity[headerKey] !== undefined && activity[headerKey] !== null) {
                      if (typeof activity[headerKey] === 'object') {
                          cellContent = `<pre>${JSON.stringify(activity[headerKey], null, 2)}</pre>`;
                      } else if (typeof activity[headerKey] === 'boolean') {
                          cellContent = activity[headerKey] ? 'Evet' : 'HayÄ±r';
                      } else {
                          cellContent = activity[headerKey].toString();
                      }
                      td.innerHTML = cellContent;
                  } else {
                      td.innerHTML = '<span style="color:#9b98a7;font-style:italic;">Yok</span>';
                  }
                  tr.appendChild(td);
              });
              tableBody.appendChild(tr);
          });
      }).catch(error => {
          console.error("Tablo oluÅŸturulurken hata:", error);
          tableBody.innerHTML = `<tr><td colspan="${finalHeaders.length}" style="text-align:center; color:red;">Veri yÃ¼klenirken veya iÅŸlenirken hata oluÅŸtu: ${error.message}</td></tr>`;
      });
  });
  </script>
  {% endblock %}